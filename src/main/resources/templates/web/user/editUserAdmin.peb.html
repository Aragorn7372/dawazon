{% include "common/header" %}
{% include "common/navbar" %}
{% set currentPath = request.servletPath %}
{% set isUserView = currentPath equals '/auth/me' %}
{% set isUserEdit = currentPath equals '/auth/me/edit' %}
{% set isEditAdmin = currentPath equals 'auth/me/user/edit/{{user.getId}}' %}
{% set isAdminView= currentPath equals 'auth/me/user/{{user.getId}}' %}
<div class="container col-12">

    <form action="{% if isEditAdmin %}/admin/users/edit {% elseif isUserEdit %}/auth/me/edit{% endif %}" method="{% if isEditAdmin %}POST {% elseif isUserEdit %}POST{% else %} GET {% endif %}">
        <input type="hidden" name="id" value="{{ user.id }}">

        <div class="admin-header"
             style="text-align: center; display: flex; flex-direction: column; align-items: center;">
            <div class="admin-avatar">
                {% if user.avatarUrl %}
                <img src="{{ user.avatarUrl }}" alt="Avatar">
                {% endif %}
            </div>
            <h3 class="product-title" style="font-size: 1.4rem;">{{ user.username }}</h3>
        </div>

        <div class="product-main-grid">

            <div class="product-info" style="text-align: left; align-items: stretch;">
                <div class="form-group">
                    <label class="form-label">Nombre</label>
                    <input type="text" name="nombre" class="form-input" value="{{ user.nombre }}" {% if isUserView or isAdminView %}readonly{% endif %}}>
                </div>

                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" class="form-input" value="{{ user.email }}" {% if isUserView or isAdminView %}readonly{% endif %}}>
                </div>

                <div class="form-group">
                    <label class="form-label">Teléfono</label>
                    <input type="text" name="telefono" class="form-input" value="{{ user.telefono }}" {% if isUserView or isAdminView %}readonly{% endif %}}>
                </div>
            </div>

            {% if isNotHimSelf %}
            {% if isAdmin %}
            <div class="product-info" style="text-align: left; align-items: stretch;">
                <label class="form-label">Roles</label>
                <div class="roles-list">

                    <div style="margin-bottom: 8px;">
                        <label style="cursor: pointer; display: flex; align-items: center; gap: 10px;">
                        <select name="roles" id="roles" >
                        {% for role in user.getRoles %}
                        <option value="{{role.getName}}">{{role}}</option>
                        {% endfor %}
                        </select>
                        </label>
                    </div>

                </div>
            </div>
            {% endif %}
{% endif %}

        </div>

        <div class="action-buttons admin-actions" style="margin-top: 20px;">
            {% if isUser %}
            <a href="/auth/me/favs" class="btn-gradient"
               style="text-decoration: none; display: flex; justify-content: center; align-items: center;">
                Favs
            </a>
            {% endif %}
            {% if isUserEdit or isEditAdmin %}
            <button type="submit"
                    class="btn-gradient">
                Guardar
            </button>
            {% else%}
            <button type="submit"
                    formaction="{% if isNotHimSelf %}/auth/me/user/edit/{{user.getId}}{% else %}/auth/me/edit{% endif %} "
                    class="btn-gradient">
                Editar
            </button>
            {% endif %}

            <button type="submit"
                    formaction="{% if isHimSelf %}/auth/me/delete{% else %}/admin/users/delete/{{user.id}}{% endif %}"
                    class="btn-gradient btn-delete">
                Eliminar cuenta
            </button>

            <button type="submit"
                    formaction="{% if isHimSelf %}/auth/me/changepassword{% else %}/auth/me/reset-password/{{user.id}}{% endif %}"
                    class="btn-gradient btn-reset">
                Restablecer contraseña
            </button>
        </div>
    </form>
</div>
{% include "common/footer" %}